# .github/workflows/update-profile.yml
name: ğŸš€ Update GitHub Profile

on:
  schedule:
    # ØªØ´ØºÙŠÙ„ ÙƒÙ„ 6 Ø³Ø§Ø¹Ø§Øª
    - cron: '0 */6 * * *'
  
  # ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ push Ø¥Ù„Ù‰ main branch
  push:
    branches: [ main, master ]
    paths:
      - 'github_profile_generator.py'
      - '.github/workflows/update-profile.yml'
  
  # ØªØ´ØºÙŠÙ„ ÙŠØ¯ÙˆÙŠ
  workflow_dispatch:

jobs:
  update-profile:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ”„ Checkout Repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0
    
    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        cache: 'pip'
    
    - name: ğŸ“¦ Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests matplotlib seaborn numpy python-dateutil
        # ØªØ«Ø¨ÙŠØª Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
        sudo apt-get update
        sudo apt-get install -y fonts-dejavu-core fonts-liberation
    
    - name: ğŸ“Š Generate Profile Stats
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        python github_profile_generator.py
    
    - name: ğŸ¨ Optimize Images
      run: |
        # ØªØ­Ø³ÙŠÙ† Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ± Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ØªÙˆÙØ±Ø©
        if command -v optipng &> /dev/null; then
          find . -name "*.png" -exec optipng -o2 {} \;
        fi
        
        # Ø¥Ù†Ø´Ø§Ø¡ thumbnails Ù„Ù„ØµÙˆØ± Ø§Ù„ÙƒØ¨ÙŠØ±Ø©
        if [ -f "github_dashboard.png" ]; then
          echo "âœ… Dashboard image created: $(ls -lh github_dashboard.png)"
        fi
        
        if [ -f "language_distribution.png" ]; then
          echo "âœ… Language chart created: $(ls -lh language_distribution.png)"
        fi
    
    - name: ğŸ“ Validate Generated Files
      run: |
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
        required_files=("README.md" "github_stats.json")
        
        for file in "${required_files[@]}"; do
          if [ -f "$file" ]; then
            echo "âœ… $file exists"
            # Ø¹Ø±Ø¶ Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù
            ls -lh "$file"
          else
            echo "âŒ $file is missing!"
            exit 1
          fi
        done
        
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© JSON
        if ! python -m json.tool github_stats.json > /dev/null; then
          echo "âŒ Invalid JSON in github_stats.json"
          exit 1
        fi
        
        echo "âœ… All files validated successfully"
    
    - name: ğŸ“ˆ Display Statistics Summary
      run: |
        if [ -f "github_stats.json" ]; then
          echo "ğŸ“Š Generated Statistics Summary:"
          python -c "
